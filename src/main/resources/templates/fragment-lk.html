<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Фрагменты личного кабинета</title>
</head>
<body>
<!-- ================= ФРАГМЕНТ: МОИ ТАТУИРОВКИ (first-fragment) ================= -->
<div class="tattoos-reviews" th:fragment="first-fragment">
    <!-- Секция с татуировками -->
    <div class="tattoos-section">
        <!-- Заголовок секции -->
        <div class="section-header">
            <h3>
                <i class="fa fa-picture-o"></i>
                Мои татуировки
            </h3>
            <span class="section-count" th:if="${not #lists.isEmpty(UserDTO.images)}"
                  th:text="'Всего: ' + ${#lists.size(UserDTO.images)}">Всего: 0</span>
        </div>

        <!-- Контейнер с татуировками (если есть) -->
        <div class="tattoos-grid-container" th:if="${not #lists.isEmpty(UserDTO.images)}">
            <div class="tattoos-grid">
                <div class="tattoo-card" th:each="current : ${UserDTO.images}">
                    <div class="tattoo-image-wrapper">
                        <img th:src="@{'/images/'+${current.imageName}}"
                             th:alt="${current.description} ?: 'Татуировка'"
                             class="tattoo-image">

                        <!-- Оверлей при наведении -->
                        <div class="tattoo-overlay">
                            <p class="tattoo-description" th:text="${current.description} ?: 'Без описания'">
                                Описание татуировки
                            </p>
                            <div class="tattoo-actions">
                                <button class="tattoo-btn delete-btn"
                                        th:if="${current.id}"
                                        th:onclick="'deleteTattoo(' + ${current.id} + ')'"
                                        title="Удалить">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Пустое состояние -->
        <div class="empty-state" th:if="${#lists.isEmpty(UserDTO.images)}">
            <i class="fa fa-picture-o"></i>
            <h4>У вас пока нет татуировок</h4>
            <p>Добавьте свою первую татуировку, используя форму ниже</p>
        </div>
    </div>

    <!-- Форма добавления новой татуировки -->
    <div class="add-section">
        <div class="section-header" style="margin-top: 30px;">
            <h4>
                <i class="fa fa-plus-circle"></i>
                Добавить новую татуировку
            </h4>
        </div>

        <form class="modern-form"
              onsubmit="submitForm(event, '.content-body')"
              action="/tattoos-user-import"
              method="POST"
              enctype="multipart/form-data"
              th:object="${userTattoo}">

            <div class="form-row">
                <!-- Левая колонка: загрузка изображения -->
                <div class="form-col-image">
                    <div class="image-upload-container">
                        <div class="image-preview">
                            <img id="previewimage" src="/img/placeholder.jpg" alt="Превью">
                            <div class="preview-placeholder" id="preview-placeholder">
                                <i class="fa fa-cloud-upload"></i>
                                <span>Выберите фото тату</span>
                            </div>
                        </div>

                        <div class="upload-controls">
                            <button type="button" class="upload-file-btn"
                                    onclick="document.getElementById('tattoos').click()">
                                <i class="fa fa-folder-open"></i>
                                Выбрать файл
                            </button>
                            <input type="file" name="file" id="tattoos" accept="image/*"
                                   onchange="previewImage(this, document.getElementById('previewimage'))"
                                   required style="display: none;">
                            <span class="file-hint">JPG, PNG, GIF (макс. 10MB)</span>
                        </div>
                    </div>
                </div>

                <!-- Правая колонка: описание -->
                <div class="form-col-content">
                    <div class="form-group">
                        <label for="description">
                            <i class="fa fa-align-left"></i>
                            Описание татуировки
                        </label>
                        <textarea id="description"
                                  name="description"
                                  class="form-control"
                                  placeholder="Опишите вашу татуировку: идея, стиль, значение..."
                                  rows="6"
                                  required></textarea>
                        <span class="field-hint">Минимум 10 символов, максимум 500</span>
                    </div>

                    <!-- Кнопки формы -->
                    <div class="form-actions">
                        <button type="reset" class="btn btn-secondary" onclick="resetPreview()">
                            <i class="fa fa-undo"></i>
                            Очистить
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fa fa-save"></i>
                            Сохранить тату
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ================= ФРАГМЕНТ: РЕДАКТИРОВАНИЕ ПРОФИЛЯ (profile-editing) ================= -->
<div class="profile-editing" th:fragment="profile-editing">
    <!-- Заголовок секции -->
    <div class="section-header">
        <h3>
            <i class="fa fa-user-circle"></i>
            Редактирование профиля
        </h3>
        <span class="section-badge">Настройки аккаунта</span>
    </div>

    <!-- Две колонки -->
    <div class="profile-edit-grid">
        <!-- Левая колонка: форма с данными -->
        <div class="profile-edit-form-col">
            <div class="profile-edit-card">
                <div class="card-header">
                    <i class="fa fa-cog"></i>
                    <h4>Основная информация</h4>
                </div>

                <div class="card-body">
                    <form class="modern-form profile-form"
                          action="/update/profile-editing"
                          onsubmit="submitForm(event, '.content-body')"
                          method="post"
                          th:id="*{id}"
                          th:object="${UserDTO}">

                        <!-- Имя пользователя -->
                        <div class="form-group">
                            <label for="username">
                                <i class="fa fa-user"></i>
                                Имя пользователя
                            </label>
                            <input type="text"
                                   th:field="*{login}"
                                   id="username"
                                   name="username"
                                   class="form-control"
                                   placeholder="Введите ваше имя пользователя"
                                   required>
                            <span class="field-hint">Будет отображаться в профиле и отзывах</span>
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label for="email">
                                <i class="fa fa-envelope"></i>
                                Email
                            </label>
                            <input type="email"
                                   th:field="*{email}"
                                   id="email"
                                   name="email"
                                   class="form-control"
                                   placeholder="Введите ваш email"
                                   required>
                            <span class="field-hint">Используется для входа и уведомлений</span>
                        </div>

                        <!-- Пароль -->
                        <div class="form-group">
                            <label for="password">
                                <i class="fa fa-lock"></i>
                                Новый пароль
                            </label>
                            <input type="password"
                                   id="password"
                                   name="password"
                                   class="form-control"
                                   placeholder="Оставьте пустым, если не хотите менять">
                            <span class="field-hint">Минимум 6 символов</span>
                        </div>

                        <!-- Подтверждение пароля -->
                        <div class="form-group">
                            <label for="confirm-password">
                                <i class="fa fa-lock"></i>
                                Подтверждение пароля
                            </label>
                            <input type="password"
                                   id="confirm-password"
                                   name="confirm-password"
                                   class="form-control"
                                   placeholder="Повторите новый пароль">
                        </div>

                        <!-- Кнопка сохранения -->
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fa fa-save"></i>
                                Сохранить изменения
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Правая колонка: аватар -->
        <div class="profile-avatar-col">
            <div class="profile-edit-card">
                <div class="card-header">
                    <i class="fa fa-camera"></i>
                    <h4>Фото профиля</h4>
                </div>

                <div class="card-body avatar-card-body">
                    <!-- Текущий аватар -->
                    <div class="avatar-preview-container">
                        <div class="avatar-preview">
                            <img id="avatar"
                                 th:src="${UserDTO.avatar} ? @{'/images/'+${UserDTO.avatar}} : '/img/default-avatar.jpg'"
                                 alt="Ваш аватар"
                                 class="avatar-image">
                        </div>
                    </div>

                    <!-- Форма загрузки -->
                    <form class="avatar-upload-form"
                          onsubmit="submitForm(event, '.profile-avatar')"
                          action="/avatar-import"
                          method="POST"
                          enctype="multipart/form-data">

                        <div class="upload-controls vertical">
                            <button type="button" class="upload-file-btn"
                                    onclick="document.getElementById('file-avatar').click()">
                                <i class="fa fa-folder-open"></i>
                                Выбрать новое фото
                            </button>
                            <input type="file" name="file" id="file-avatar"
                                   accept="image/*"
                                   onchange="updateAvatar(this, document.getElementById('avatar'))"
                                   style="display: none;">
                            <span class="file-hint">
                                <i class="fa fa-info-circle"></i>
                                Рекомендуемый размер: 500x500px
                            </span>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fa fa-upload"></i>
                                Загрузить аватар
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Информационный блок -->
            <div class="info-box">
                <i class="fa fa-shield"></i>
                <div class="info-content">
                    <h5>Безопасность</h5>
                    <p>Рекомендуем использовать надежный пароль и регулярно его обновлять.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ================= ФРАГМЕНТ: МОИ ОТЗЫВЫ (review-fragment) ================= -->
<div class="reviews-fragment" th:fragment="review-fragment">
    <!-- Заголовок секции -->
    <div class="section-header">
        <h3>
            <i class="fa fa-comments"></i>
            Мои отзывы
        </h3>
        <span class="section-count" th:if="${not #lists.isEmpty(UserDTO.reviews)}"
              th:text="'Всего: ' + ${#lists.size(UserDTO.reviews)}">Всего: 0</span>
    </div>

    <!-- Контейнер с отзывами -->
    <div class="reviews-container" th:if="${not #lists.isEmpty(UserDTO.reviews)}">
        <div class="reviews-list-container">
            <div class="reviews-list">
                <div class="review-card" th:each="review : ${UserDTO.reviews}">
                    <!-- Шапка отзыва -->
                    <div class="review-card-header">
                        <div class="review-author-avatar">
                            <img th:if="${review.imageName}"
                                 th:src="@{'/images/'+${review.imageName}}"
                                 alt="Фото автора"
                                 class="avatar-img">
                            <img th:unless="${review.imageName}"
                                 src="/img/default-avatar.jpg"
                                 alt="Фото автора"
                                 class="avatar-img">
                        </div>
                        <div class="review-author-info">
                            <h4 class="review-author-name" th:text="${UserDTO.login}">Имя пользователя</h4>
                            <div class="review-meta">
                                <span class="review-date">
                                    <i class="fa fa-calendar"></i>
                                    [[${review.date}]]
                                </span>
                            </div>
                        </div>

                        <!-- Кнопка удаления -->
                        <button class="review-delete-btn"
                                th:if="${review.id}"
                                th:onclick="'deleteReview(' + ${review.id} + ')'"
                                title="Удалить отзыв">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>

                    <!-- Тело отзыва -->
                    <div class="review-card-body">
                        <p class="review-content" th:text="${review.comment}">Текст отзыва</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Пустое состояние -->
    <div class="empty-state" th:if="${#lists.isEmpty(UserDTO.reviews)}">
        <i class="fa fa-comments"></i>
        <h4>У вас пока нет отзывов</h4>
        <p>Оставьте свой первый отзыв о нашей работе!</p>
    </div>

    <!-- Форма добавления отзыва -->
    <div class="add-review-section">
        <div class="section-header" style="margin-top: 30px;">
            <h4>
                <i class="fa fa-plus-circle"></i>
                Оставить новый отзыв
            </h4>
        </div>

        <form class="modern-form"
              onsubmit="submitForm(event, '.content-body')"
              method="POST"
              action="/reviews-user-import"
              enctype="multipart/form-data">

            <div class="form-row">
                <!-- Левая колонка: фото -->
                <div class="form-col-image-small">
                    <div class="image-upload-container">
                        <div class="image-preview">
                            <img id="reviewImage" src="/img/placeholder-image.jpg" alt="Превью">
                            <div class="preview-placeholder small" id="review-placeholder">
                                <i class="fa fa-camera"></i>
                                <span>Добавить фото</span>
                            </div>
                        </div>

                        <div class="upload-controls">
                            <button type="button" class="upload-file-btn small"
                                    onclick="showModals()">
                                <i class="fa fa-folder-open"></i>
                                Выбрать из галереи
                            </button>
                            <span class="file-hint or-divider">или</span>
                            <button type="button" class="upload-file-btn small"
                                    onclick="document.getElementById('review-image-file').click()">
                                <i class="fa fa-cloud-upload"></i>
                                Загрузить новое
                            </button>
                            <input type="file" name="file" id="review-image-file"
                                   accept="image/*"
                                   onchange="previewReviewImage(this)"
                                   style="display: none;">
                            <input type="hidden" id="reviewImageName" name="imageName">
                            <span class="file-hint">Необязательно, макс. 5MB</span>
                        </div>
                    </div>
                </div>

                <!-- Правая колонка: текст отзыва -->
                <div class="form-col-content">
                    <!-- Рейтинг -->
                    <div class="rating-group">
                        <label>
                            <i class="fa fa-star"></i>
                            Ваша оценка
                        </label>
                        <div class="rating-stars">
                            <input type="radio" name="rating" id="star5" value="5" checked>
                            <label for="star5" title="5 звезд">★</label>
                            <input type="radio" name="rating" id="star4" value="4">
                            <label for="star4" title="4 звезды">★</label>
                            <input type="radio" name="rating" id="star3" value="3">
                            <label for="star3" title="3 звезды">★</label>
                            <input type="radio" name="rating" id="star2" value="2">
                            <label for="star2" title="2 звезды">★</label>
                            <input type="radio" name="rating" id="star1" value="1">
                            <label for="star1" title="1 звезда">★</label>
                        </div>
                    </div>

                    <!-- Текст отзыва -->
                    <div class="form-group">
                        <label for="review-comment">
                            <i class="fa fa-comment"></i>
                            Ваш отзыв
                        </label>
                        <textarea id="review-comment"
                                  name="Comment"
                                  class="form-control"
                                  placeholder="Поделитесь своими впечатлениями..."
                                  rows="4"
                                  required></textarea>
                        <span class="field-hint">Минимум 10 символов, максимум 1000</span>
                    </div>

                    <!-- Кнопки -->
                    <div class="form-actions">
                        <button type="reset" class="btn btn-secondary" onclick="resetReviewForm()">
                            <i class="fa fa-undo"></i>
                            Очистить
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fa fa-paper-plane"></i>
                            Отправить отзыв
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
</body>
</html>