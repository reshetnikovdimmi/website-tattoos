<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Фрагменты личного кабинета</title>
</head>
<body>
<!-- ================= ФРАГМЕНТ: МОИ ТАТУИРОВКИ (first-fragment) ================= -->
<div class="tattoos-reviews" th:fragment="first-fragment">
    <!-- Список татуировок пользователя -->
    <div class="tattoos-section">
        <div class="section-header">
            <h3>
                <i class="fa fa-picture-o"></i>
                Мои татуировки
            </h3>
            <span class="section-count" th:if="${not #lists.isEmpty(UserDTO.images)}"
                  th:text="'Всего: ' + ${#lists.size(UserDTO.images)}">Всего: 0</span>
        </div>

        <!-- Контейнер с фиксированной высотой и скроллом -->
        <div class="tattoos-grid-container scrollable"
             th:if="${not #lists.isEmpty(UserDTO.images)}">
            <div class="tattoos-grid">
                <div class="tattoo-card" th:each="current : ${UserDTO.images}">
                    <div class="tattoo-image-wrapper">
                        <img th:src="@{'/images/'+${current.imageName}}"
                             th:alt="${current.description} ?: 'Татуировка'"
                             class="tattoo-image">

                        <!-- Оверлей с информацией при наведении -->
                        <div class="tattoo-overlay">
                            <p class="tattoo-description" th:text="${current.description} ?: 'Без описания'">
                                Описание татуировки
                            </p>
                            <div class="tattoo-actions">
                                <button class="tattoo-btn delete-btn"
                                        th:if="${current.id}"
                                        th:onclick="'deleteTattoo(' + ${current.id} + ')'"
                                        title="Удалить">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Пустое состояние с иконкой -->
        <div class="empty-state" th:if="${#lists.isEmpty(UserDTO.images)}">
            <i class="fa fa-picture-o"></i>
            <h4>У вас пока нет татуировок</h4>
            <p>Добавьте свою первую татуировку, используя форму ниже</p>
        </div>
    </div>

    <!-- Форма добавления новой татуировки -->
    <div class="row">
        <div class="container" th:object="${userTattoo}">
            <form onsubmit="submitForm(event, '.content-body')"
                  action="/tattoos-user-import"
                  method="POST"
                  enctype="multipart/form-data"
                  class="modern-form lk-form">

                <div class="form-row">
                    <!-- Блок загрузки изображения -->
                    <div class="form-col form-col-image">
                        <div class="image-upload-container">
                            <div class="image-preview">
                                <img id="previewimage" src="/img/placeholder.jpg" alt="Превью">
                                <div class="preview-placeholder" id="preview-placeholder">
                                    <i class="fa fa-cloud-upload"></i>
                                    <span>Выберите фото тату</span>
                                </div>
                            </div>

                            <div class="upload-controls">
                                <button type="button" class="upload-file-btn"
                                        onclick="document.getElementById('tattoos').click()">
                                    <i class="fa fa-folder-open"></i>
                                    Выбрать файл
                                </button>
                                <input type="file" name="file" id="tattoos" accept="image/*"
                                       onchange="previewImage(this, document.getElementById('previewimage'))"
                                       required="" style="display: none;">
                                <span class="file-hint">JPG, PNG, GIF (макс. 10MB)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Блок описания -->
                    <div class="form-col form-col-content">
                        <div class="form-group">
                            <label for="description">
                                <i class="fa fa-align-left"></i>
                                Описание татуировки
                            </label>
                            <textarea id="description"
                                      name="description"
                                      class="form-control"
                                      placeholder="Опишите вашу татуировку: идея, стиль, значение..."
                                      rows="6"
                                      required=""></textarea>
                            <span class="field-hint">Минимум 10 символов, максимум 500</span>
                        </div>

                        <!-- Кнопки формы -->
                        <div class="form-actions">
                            <button type="reset" class="btn btn-secondary" onclick="resetPreview()">
                                <i class="fa fa-undo"></i>
                                Очистить
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fa fa-save"></i>
                                Сохранить тату
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ================= ФРАГМЕНТ: РЕДАКТИРОВАНИЕ ПРОФИЛЯ (profile-editing) ================= -->
<div class="profile-editing" th:fragment="profile-editing">
    <!-- Заголовок секции -->
    <div class="section-header">
        <h3>
            <i class="fa fa-user-circle"></i>
            Редактирование профиля
        </h3>
        <span class="section-badge">Настройки аккаунта</span>
    </div>

    <!-- Две колонки: основная информация и аватар -->
    <div class="profile-edit-grid">

        <!-- Левая колонка: форма редактирования данных -->
        <div class="profile-edit-form-col">
            <div class="profile-edit-card">
                <div class="card-header">
                    <i class="fa fa-cog"></i>
                    <h4>Основная информация</h4>
                </div>

                <div class="card-body">
                    <form class="modern-form profile-form"
                          action="/update/profile-editing"
                          onsubmit="submitForm(event, '.container-lk-info')"
                          method="post"
                          th:id="*{id}"
                          th:object="${UserDTO}">

                        <!-- Имя пользователя -->
                        <div class="form-group">
                            <label for="username">
                                <i class="fa fa-user"></i>
                                Имя пользователя
                            </label>
                            <input type="text"
                                   th:field="*{login}"
                                   id="username"
                                   name="username"
                                   class="form-control"
                                   placeholder="Введите ваше имя пользователя"
                                   required>
                            <span class="field-hint">Будет отображаться в профиле и отзывах</span>
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label for="email">
                                <i class="fa fa-envelope"></i>
                                Email
                            </label>
                            <input type="email"
                                   th:field="*{email}"
                                   id="email"
                                   name="email"
                                   class="form-control"
                                   placeholder="Введите ваш email"
                                   required>
                            <span class="field-hint">Используется для входа и уведомлений</span>
                        </div>

                        <!-- Пароль (необязательно) -->
                        <div class="form-group">
                            <label for="password">
                                <i class="fa fa-lock"></i>
                                Новый пароль
                            </label>
                            <input type="password"
                                   id="password"
                                   name="password"
                                   class="form-control"
                                   placeholder="Оставьте пустым, если не хотите менять">
                            <span class="field-hint">Минимум 6 символов</span>
                        </div>

                        <!-- Подтверждение пароля -->
                        <div class="form-group">
                            <label for="confirm-password">
                                <i class="fa fa-lock"></i>
                                Подтверждение пароля
                            </label>
                            <input type="password"
                                   id="confirm-password"
                                   name="confirm-password"
                                   class="form-control"
                                   placeholder="Повторите новый пароль">
                        </div>

                        <!-- Кнопка сохранения -->
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fa fa-save"></i>
                                Сохранить изменения
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Правая колонка: аватар -->
        <div class="profile-avatar-col">
            <div class="profile-edit-card">
                <div class="card-header">
                    <i class="fa fa-camera"></i>
                    <h4>Фото профиля</h4>
                </div>

                <div class="card-body avatar-card-body">
                    <!-- Текущий аватар -->
                    <div class="avatar-preview-container">
                        <div class="avatar-preview">
                            <img id="avatar"
                                 th:src="${UserDTO.avatar} ? @{'/images/'+${UserDTO.avatar}} : '/img/default-avatar.jpg'"
                                 alt="Ваш аватар"
                                 class="avatar-image">
                        </div>
                    </div>

                    <!-- Форма загрузки аватара -->
                    <form class="avatar-upload-form"
                          onsubmit="submitForm(event, '.container-lk-info')"
                          action="/avatar-import"
                          method="POST"
                          enctype="multipart/form-data">

                        <div class="upload-controls vertical">
                            <button type="button" class="upload-file-btn"
                                    onclick="document.getElementById('file-avatar').click()">
                                <i class="fa fa-folder-open"></i>
                                Выбрать новое фото
                            </button>
                            <input type="file" name="file" id="file-avatar"
                                   accept="image/*"
                                   onchange="updateAvatar(this, document.getElementById('avatar'))"
                                   style="display: none;">
                            <span class="file-hint">
                                <i class="fa fa-info-circle"></i>
                                Рекомендуемый размер: 500x500px. Форматы: JPG, PNG, GIF
                            </span>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fa fa-upload"></i>
                                Загрузить аватар
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Дополнительная информация -->
            <div class="info-box">
                <i class="fa fa-shield"></i>
                <div class="info-content">
                    <h5>Безопасность</h5>
                    <p>Рекомендуем использовать надежный пароль и регулярно его обновлять. Никогда не передавайте свои данные третьим лицам.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ================= ФРАГМЕНТ: МОИ ОТЗЫВЫ (review-fragment) ================= -->
<div class="review-fragment" th:fragment="review-fragment">
    <h6>Мои отзывы</h6>

    <!-- Список отзывов -->
    <div class="row scroll-container">
        <div class="input-user-reviews">
            <section class="review" th:each="current : ${UserDTO.reviews}"
                     th:if="${not #lists.isEmpty(UserDTO.reviews)}">
                <div class="review-header">
                    <img th:if="${current.imageName}"
                         th:src="@{'/images/'+${current.imageName}}"
                         alt="Фото автора отзыва"
                         class="avatar">
                    <img th:unless="${current.imageName}"
                         src="/img/default-avatar.jpg"
                         alt="Фото автора отзыва"
                         class="avatar">
                    <div class="author-info">
                        <p><strong>[[${UserDTO.login}]]</strong></p>
                        <p>[[${current.date}]]</p>
                    </div>
                </div>
                <p class="review-text">[[${current.comment}]]</p>

                <!-- Кнопки действий (если нужны) -->
                <div class="text-right" th:if="${current.id}">
                    <button class="btn btn-sm btn-outline-danger"
                            th:onclick="'deleteReview(' + ${current.id} + ')'">
                        Удалить
                    </button>
                </div>
            </section>

            <!-- Пустое состояние -->
            <div class="text-center p-4" th:if="${#lists.isEmpty(UserDTO.reviews)}">
                <p class="text-muted">У вас пока нет отзывов</p>
            </div>
        </div>
    </div>

    <!-- Форма добавления нового отзыва -->
    <div class="row">
        <div class="container">
            <div class="row justify-content-center">
                <div class="card shadow-sm p-3 mb-5 rounded">
                    <form onsubmit="submitForm(event, '.container-lk-info')"
                          method="POST"
                          action="/reviews-user-import">

                        <div class="row mb-3 text-center">
                            <!-- Блок загрузки изображения -->
                            <div class="col-6 col-lg-4 themed-grid-col">
                                <div class="avatar-container">
                                    <img id="imageID" src="/img/avatar.jpg" alt="Выберите тату для отзыва">
                                    <button type="button" class="upload-btn btn btn-primary" onclick="showModals()">
                                        Выбрать файл
                                    </button>
                                    <input type="file" name="file" id="avatar-input" accept="image/*"
                                           onchange="loadImage(this)">
                                    <input type="text" id="imageName" style="display: none;" name="imageName">
                                </div>
                            </div>

                            <!-- Блок текста отзыва -->
                            <div class="col-sm-6 col-lg-8 themed-grid-col">
                                <div class="input-group">
                                    <span class="input-group-text" style="height: 158px;">Текст</span>
                                    <textarea class="form-control" name="Comment"
                                              aria-label="С текстовым полем"
                                              placeholder="Напишите ваш отзыв..."
                                              required></textarea>
                                    <button class="btn btn-primary" type="submit">
                                        Сохранить отзыв
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>